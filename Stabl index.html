<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>StepStar</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app" class="app-viewport"></div>

    <div class="tab-bar">
        <div class="tab-item active" id="btn-home" onclick="navigate('home', this)"><i>ğŸ </i><span id="txt-home"></span></div>
        <div class="tab-item" id="btn-rank" onclick="navigate('rank', this)"><i>ğŸ†</i><span id="txt-rank"></span></div>
        <div class="tab-item" id="btn-tour" onclick="navigate('tour', this)"><i>ğŸ</i><span id="txt-tour"></span></div>
        <div class="tab-item" id="btn-prof" onclick="navigate('prof', this)"><i>ğŸ‘¤</i><span id="txt-prof"></span></div>
    </div>

    <script src="assets.js"></script>
    <script src="pages.js"></script>

    <script>
        const tg = window.Telegram.WebApp;
        // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ğ»Ğ¸ coins Ğ² ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ
        let userState = { frame: 'blue', steps: 6420, coins: 150 };
        const appLang = (tg.initDataUnsafe?.user?.language_code === 'ru') ? 'ru' : 'en';

        // Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ¿Ñ€Ğ¸Ğ³Ğ»Ğ°ÑˆĞµĞ½Ğ¸Ñ Ğ´Ñ€ÑƒĞ·ĞµĞ¹
        function inviteFriends() {
            const botUsername = 'StepStarAppBot'; 
            const inviteText = encodeURIComponent("ĞŸÑ€Ğ¸Ğ²ĞµÑ‚! Ğ”Ğ°Ğ²Ğ°Ğ¹ ÑÑ‡Ğ¸Ñ‚Ğ°Ñ‚ÑŒ ÑˆĞ°Ğ³Ğ¸ Ğ²Ğ¼ĞµÑÑ‚Ğµ Ğ² StepStar ğŸ‘Ÿ");
            const inviteUrl = `https://t.me/share/url?url=https://t.me/${botUsername}&text=${inviteText}`;
            
            if (tg) {
                tg.openTelegramLink(inviteUrl);
                if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('medium');
            }
        }

        function shareResult(steps) {
            const botUsername = 'StepStarAppBot'; 
            const message = encodeURIComponent(t('shareMsg', appLang).replace('{n}', steps));
            const shareUrl = `https://t.me/share/url?url=https://t.me/${botUsername}&text=${message}`;
            tg.openTelegramLink(shareUrl);
        }

        function navigate(pageId, el) {
            try {
                const app = document.getElementById('app');
                const user = tg.initDataUnsafe?.user || { first_name: "User", photo_url: "" };
                
                // Ğ¡Ğ¿ĞµÑ†Ğ¸Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° Ğ´Ğ»Ñ Ğ¼Ğ°Ğ³Ğ°Ğ·Ğ¸Ğ½Ğ°
                if (pageId === 'shop') {
                    app.innerHTML = Pages.shop(user, userState, appLang);
                    return;
                }

                if (typeof Pages !== 'undefined' && Pages[pageId]) {
                    app.innerHTML = Pages[pageId](user, userState, appLang);
                }

                // ĞŸĞ¾Ğ´ÑĞ²ĞµÑ‚ĞºĞ° ĞºĞ½Ğ¾Ğ¿Ğ¾Ğº Ğ¼ĞµĞ½Ñ
                if (el) {
                    document.querySelectorAll('.tab-item').forEach(i => i.classList.remove('active'));
                    el.classList.add('active');
                }
                
                if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('light');
            } catch (e) {
                console.error("Navigation error:", e);
            }
        }

        function changeFrame(color) {
            userState.frame = color;
            navigate('shop'); // ĞÑÑ‚Ğ°ĞµĞ¼ÑÑ Ğ² Ğ¼Ğ°Ğ³Ğ°Ğ·Ğ¸Ğ½Ğµ Ğ¿Ğ¾ÑĞ»Ğµ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ°
            tg.HapticFeedback.notificationOccurred('success');
        }

        window.onload = () => {
            tg.expand();
            tg.ready();
            document.getElementById('txt-home').innerText = t('home', appLang);
            document.getElementById('txt-rank').innerText = t('rank', appLang);
            document.getElementById('txt-tour').innerText = t('tour', appLang);
            document.getElementById('txt-prof').innerText = t('prof', appLang);
            navigate('home', document.getElementById('btn-home'));
        };
    </script>
</body>
</html>
