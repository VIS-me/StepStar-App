<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>StepStar</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app" class="app-viewport"></div>

    <div class="tab-bar">
        <div class="tab-item active" id="btn-home" onclick="navigate('home', this)"><i>ğŸ </i><span id="txt-home"></span></div>
        <div class="tab-item" id="btn-rank" onclick="navigate('rank', this)"><i>ğŸ†</i><span id="txt-rank"></span></div>
        <div class="tab-item" id="btn-tour" onclick="navigate('tour', this)"><i>ğŸ</i><span id="txt-tour"></span></div>
        <div class="tab-item" id="btn-prof" onclick="navigate('prof', this)"><i>ğŸ‘¤</i><span id="txt-prof"></span></div>
    </div>

    <script src="assets.js"></script>
    <script src="home.js"></script>
    <script src="rank.js"></script>
    <script src="tour.js"></script>
    <script src="prof.js"></script>
    <script src="shop.js"></script>
    <script src="achievements.js"></script> <script>
        const tg = window.Telegram.WebApp;
        
        // Ğ“Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
        let userState = { 
            frame: 'blue', 
            steps: 6420, 
            coins: 150 
        };

        // ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ ÑĞ·Ñ‹ĞºĞ° (RU, UK Ğ¸Ğ»Ğ¸ EN)
        const appLang = (tg.initDataUnsafe?.user?.language_code === 'ru' || tg.initDataUnsafe?.user?.language_code === 'uk') 
            ? tg.initDataUnsafe.user.language_code 
            : 'en';

        // Ğ ĞµĞµÑÑ‚Ñ€ Ğ²ÑĞµÑ… Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹Ñ… ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†
        const Pages = { 
            home: Home.render, 
            rank: Rank.render, 
            tour: Tour.render, 
            prof: Prof.render, 
            shop: Shop.render,
            achievements: Achievements.render // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¾ Ğ² Ñ€ĞµĞµÑÑ‚Ñ€
        };

        // Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ½Ğ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ğ¸
        function navigate(pageId, el) {
            const user = tg.initDataUnsafe?.user || { first_name: "User", photo_url: "" };
            const container = document.getElementById('app');
            
            // ĞÑ‚Ñ€Ğ¸ÑĞ¾Ğ²ĞºĞ° ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹ Ñ‡ĞµÑ€ĞµĞ· ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğ¹ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒ
            if (Pages[pageId]) {
                container.innerHTML = Pages[pageId](user, userState, appLang);
                // ĞŸÑ€Ğ¾ĞºÑ€ÑƒÑ‚ĞºĞ° Ğ½Ğ°Ğ²ĞµÑ€Ñ… Ğ¿Ñ€Ğ¸ ÑĞ¼ĞµĞ½Ğµ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹
                container.scrollTop = 0;
            }

            // ĞŸĞµÑ€ĞµĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ»Ğ°ÑÑĞ° Ğ² Ğ¼ĞµĞ½Ñ
            if (el) {
                document.querySelectorAll('.tab-item').forEach(i => i.classList.remove('active'));
                el.classList.add('active');
            }
            
            // Ğ¢Ğ°ĞºÑ‚Ğ¸Ğ»ÑŒĞ½Ğ°Ñ Ğ¾Ñ‚Ğ´Ğ°Ñ‡Ğ°
            if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('light');
        }

        // Ğ›Ğ¾Ğ³Ğ¸ĞºĞ° ÑƒÑ‡Ğ°ÑÑ‚Ğ¸Ñ Ğ² Ñ‚ÑƒÑ€Ğ½Ğ¸Ñ€Ğµ
        function processTournamentJoin(fee) {
            if (userState.coins >= fee) {
                tg.showConfirm(t('confirmJoin', appLang).replace('{n}', fee), (ok) => {
                    if (ok) {
                        userState.coins -= fee;
                        tg.showAlert(t('joinSuccess', appLang));
                        navigate('tour');
                    }
                });
            } else {
                tg.showAlert(t('noCoins', appLang));
            }
        }

        // Ğ›Ğ¾Ğ³Ğ¸ĞºĞ° Ğ¿Ğ¾ĞºÑƒĞ¿ĞºĞ¸/ÑĞ¼ĞµĞ½Ñ‹ Ñ€Ğ°Ğ¼ĞºĞ¸
        function changeFrame(id) {
            const item = Shop.items.find(i => i.id === id);
            if (!item) return;
            if (userState.frame === id) return;

            if (userState.coins >= item.price) {
                userState.coins -= item.price;
                userState.frame = id;
                navigate('shop');
                tg.HapticFeedback?.notificationOccurred('success');
            } else {
                tg.showAlert(t('noCoins', appLang));
            }
        }

        // ĞŸÑ€Ğ¸Ğ³Ğ»Ğ°ÑˆĞµĞ½Ğ¸Ğµ Ğ´Ñ€ÑƒĞ·ĞµĞ¹
        function inviteFriends() {
            const msg = t('shareMsg', appLang).replace('{n}', userState.steps);
            const url = `https://t.me/share/url?url=https://t.me/StepStarAppBot&text=${encodeURIComponent(msg)}`;
            tg.openTelegramLink(url);
        }

        // ĞŸĞ¾Ğ´ĞµĞ»Ğ¸Ñ‚ÑŒÑÑ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¾Ğ¼
        function shareResult(n) {
            const msg = t('shareMsg', appLang).replace('{n}', n);
            const url = `https://t.me/share/url?url=https://t.me/StepStarAppBot&text=${encodeURIComponent(msg)}`;
            tg.openTelegramLink(url);
        }

        // Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ
        window.onload = () => {
            tg.expand();
            tg.ready();

            // ĞŸĞµÑ€ĞµĞ²Ğ¾Ğ´ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞµĞ¹ Ğ² Ñ‚Ğ°Ğ±-Ğ±Ğ°Ñ€Ğµ
            const navMap = { 'home': 'home', 'rank': 'rank', 'tour': 'tour', 'prof': 'prof' };
            Object.keys(navMap).forEach(id => {
                const el = document.getElementById('txt-' + id);
                if (el) el.innerText = t(navMap[id], appLang);
            });

            // Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğ¹ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹ Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ
            navigate('home', document.getElementById('btn-home'));
        };
    </script>
</body>
</html>
