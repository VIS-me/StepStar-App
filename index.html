<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>StepStar</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="page-home" class="page active">
        <div class="user-main-info" style="text-align: center; margin-bottom: 10px; margin-top: 10px;">
            <img id="main-avatar" src="" style="width: 60px; height: 60px; border-radius: 50%; border: 3px solid var(--main-color); display: none; margin: 0 auto;">
            <h3 id="main-username" style="margin: 8px 0; font-size: 18px; font-weight: 700;">User</h3>
        </div>

        <div class="progress-container">
            <svg width="220" height="220" class="progress-ring">
                <circle stroke="rgba(0,0,0,0.05)" stroke-width="12" fill="transparent" r="100" cx="110" cy="110"/>
                <circle id="ring-progress" class="progress-ring__circle" stroke-width="12" fill="transparent" r="100" cx="110" cy="110"/>
            </svg>
            <div class="steps-content">
                <h1 id="steps-count">0</h1>
                <p id="label-steps">steps</p>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-item"><span id="val-kcal">0</span><label id="label-kcal">kcal</label></div>
            <div class="stat-item"><span id="val-km">0.0</span><label id="label-km">km</label></div>
            <div class="stat-item"><span id="val-min">0</span><label id="label-min">min</label></div>
        </div>

        <div style="padding: 20px;">
            <button id="share-btn" style="width:100%; padding:15px; border-radius:15px; border:none; background:var(--main-color); color:white; font-weight:bold; cursor:pointer;">Share Result</button>
        </div>
    </div>

    <div id="page-rank" class="page">
        <h2 style="text-align:center;" id="tab-rank-title">Rank</h2>
        <div class="winner-card">
            <div class="crown-badge" id="label-winner">Winner of the week</div>
            <img id="winner-photo" src="https://via.placeholder.com/100" style="width:90px; height:90px; border-radius:20px; border:3px solid white; margin-bottom:10px;">
            <h3 id="winner-name" style="margin:0;">Searching...</h3>
            <p id="winner-steps-val" style="margin:5px 0 0; color:var(--main-color); font-weight:bold;">0 steps</p>
        </div>
        <div id="friends-list" style="padding: 20px; text-align:center; color:gray;">
            <span id="label-friends">Your friends will appear here</span>
        </div>
    </div>

    <div id="page-tour" class="page">
        <h2 style="text-align:center;" id="tab-tour-title">Tournament</h2>
        <div style="text-align:center; margin-top:50px;">
            <span style="font-size:50px;">ğŸ</span>
            <p id="label-no-tour">No active tournaments</p>
        </div>
    </div>

    <div id="page-prof" class="page">
        <h2 style="text-align:center;" id="tab-prof-title">Profile</h2>
        <div style="text-align:center;">
            <div style="position:relative; width:100px; height:100px; margin:0 auto;">
                <img id="user-avatar-prof" src="" style="width:80px; height:80px; border-radius:50%; position:absolute; top:10px; left:10px; z-index:1; display:none;">
                <div id="user-frame" style="position:absolute; top:0; left:0; width:100%; height:100%; z-index:2; border: 4px solid transparent; border-radius:50%;"></div>
            </div>
            <h3 id="user-name-prof" style="margin-top: 15px;">User</h3>
            <button class="shop-btn" id="btn-shop">Shop âœ¨</button>
        </div>
    </div>

    <div class="tab-bar">
        <div class="tab-item active" data-page="home"><i>ğŸ </i><span id="tab-home">Home</span></div>
        <div class="tab-item" data-page="rank"><i>ğŸ†</i><span id="tab-rank">Rank</span></div>
        <div class="tab-item" data-page="tour"><i>ğŸ</i><span id="tab-tour">Tour</span></div>
        <div class="tab-item" data-page="prof"><i>ğŸ‘¤</i><span id="tab-prof">Profile</span></div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.ready();

        const lang = (tg.initDataUnsafe?.user?.language_code === 'ru') ? 'ru' : 'en';
        const ui = {
            ru: {
                steps: "ÑˆĞ°Ğ³Ğ¾Ğ²", kcal: "ĞºĞºĞ°Ğ»", km: "ĞºĞ¼", min: "Ğ¼Ğ¸Ğ½", btn: "ĞŸĞ¾Ğ´ĞµĞ»Ğ¸Ñ‚ÑŒÑÑ",
                home: "Ğ“Ğ»Ğ°Ğ²Ğ½Ğ°Ñ", rank: "Ğ ĞµĞ¹Ñ‚Ğ¸Ğ½Ğ³", tour: "Ğ¢ÑƒÑ€Ğ½Ğ¸Ñ€", prof: "ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ",
                winner: "ĞŸĞ¾Ğ±ĞµĞ´Ğ¸Ñ‚ĞµĞ»ÑŒ Ğ½ĞµĞ´ĞµĞ»Ğ¸ ğŸ‘‘", noTour: "Ğ¢ÑƒÑ€Ğ½Ğ¸Ñ€Ğ¾Ğ² Ğ¿Ğ¾ĞºĞ° Ğ½ĞµÑ‚",
                friends: "Ğ—Ğ´ĞµÑÑŒ Ğ±ÑƒĞ´ĞµÑ‚ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ´Ñ€ÑƒĞ·ĞµĞ¹", shop: "ĞœĞ°Ğ³Ğ°Ğ·Ğ¸Ğ½ âœ¨",
                shareT: "Ğ¯ Ğ¿Ñ€Ğ¾ÑˆĞµĞ» 6200 ÑˆĞ°Ğ³Ğ¾Ğ² Ğ² StepStar! ğŸ‘Ÿ"
            },
            en: {
                steps: "steps", kcal: "kcal", km: "km", min: "min", btn: "Share Result",
                home: "Home", rank: "Rank", tour: "Tour", prof: "Profile",
                winner: "Winner of the week ğŸ‘‘", noTour: "No active tournaments",
                friends: "Friends list coming soon", shop: "Shop âœ¨",
                shareT: "I walked 6200 steps in StepStar! ğŸ‘Ÿ"
            }
        };

        // ĞĞ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ñ
        function setupNavigation() {
            const tabs = document.querySelectorAll('.tab-item');
            tabs.forEach(tab => {
                tab.onclick = () => {
                    const pageId = tab.getAttribute('data-page');
                    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                    document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
                    document.getElementById('page-' + pageId).classList.add('active');
                    tab.classList.add('active');
                    if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('light');
                };
            });
        }

        // Ğ¢ĞµĞºÑÑ‚Ñ‹
        function applyLang() {
            const t = ui[lang];
            document.getElementById('label-steps').innerText = t.steps;
            document.getElementById('label-kcal').innerText = t.kcal;
            document.getElementById('label-km').innerText = t.km;
            document.getElementById('label-min').innerText = t.min;
            document.getElementById('share-btn').innerText = t.btn;
            document.getElementById('tab-home').innerText = t.home;
            document.getElementById('tab-rank').innerText = t.rank;
            document.getElementById('tab-tour').innerText = t.tour;
            document.getElementById('tab-prof').innerText = t.prof;
            document.getElementById('tab-rank-title').innerText = t.rank;
            document.getElementById('tab-tour-title').innerText = t.tour;
            document.getElementById('tab-prof-title').innerText = t.prof;
            document.getElementById('label-winner').innerText = t.winner;
            document.getElementById('label-no-tour').innerText = t.noTour;
            document.getElementById('btn-shop').innerText = t.shop;
            document.getElementById('label-friends').innerText = t.friends;
        }

        // ĞŸÑ€Ğ¾Ğ³Ñ€ĞµÑÑ
        function setProgress(pct) {
            const circle = document.getElementById('ring-progress');
            if(!circle) return;
            const circumference = 2 * Math.PI * 100;
            circle.style.strokeDashoffset = circumference - (pct * circumference);
        }

        // ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ Ğ·Ğ°Ğ¿ÑƒÑĞº
        document.addEventListener('DOMContentLoaded', () => {
            applyLang();
            setupNavigation();

            document.getElementById('share-btn').onclick = () => {
                tg.switchInlineQuery(ui[lang].shareT);
            };

            // Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ²Ğ¾ Ğ²ÑĞµ Ğ¼ĞµÑÑ‚Ğ°
            const user = tg.initDataUnsafe?.user;
            if(user) {
                // Ğ˜Ğ¼Ñ
                document.getElementById('main-username').innerText = user.first_name;
                document.getElementById('user-name-prof').innerText = user.first_name;
                
                // Ğ¤Ğ¾Ñ‚Ğ¾ (ĞµÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ)
                if(user.photo_url) {
                    const avatars = ['main-avatar', 'user-avatar-prof'];
                    avatars.forEach(id => {
                        const el = document.getElementById(id);
                        el.src = user.photo_url;
                        el.style.display = 'block';
                    });
                }
            }

            // Ğ˜Ğ¼Ğ¸Ñ‚Ğ°Ñ†Ğ¸Ñ ÑˆĞ°Ğ³Ğ¾Ğ²
            let s = 6200;
            document.getElementById('steps-count').innerText = s.toLocaleString();
            document.getElementById('val-kcal').innerText = Math.round(s * 0.04);
            document.getElementById('val-km').innerText = (s * 0.0007).toFixed(1);
            document.getElementById('val-min').innerText = Math.round(s / 100);
            setTimeout(() => setProgress(s/10000), 300);

            tg.setHeaderColor('secondary_bg_color');
        });
    </script>
</body>
</html>
