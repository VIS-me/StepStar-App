<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="app" class="app-viewport"></div>

    <div class="tab-bar">
        <div class="tab-item active" id="btn-home" onclick="navigate('home', this)"><i>ğŸ </i><span id="txt-home"></span></div>
        <div class="tab-item" id="btn-rank" onclick="navigate('rank', this)"><i>ğŸ†</i><span id="txt-rank"></span></div>
        <div class="tab-item" id="btn-tour" onclick="navigate('tour', this)"><i>ğŸ</i><span id="txt-tour"></span></div>
        <div class="tab-item" id="btn-prof" onclick="navigate('prof', this)"><i>ğŸ‘¤</i><span id="txt-prof"></span></div>
    </div>

    <script src="assets.js"></script>
    <script src="pages.js"></script>

    <script>
        const tg = window.Telegram.WebApp;
        
        // Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ (ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ)
        let userState = { frame: 'blue', steps: 6420 };
        const appLang = (tg.initDataUnsafe?.user?.language_code === 'ru') ? 'ru' : 'en';

        // Ğ›Ğ¾Ğ³Ğ¸ĞºĞ° ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ "ĞŸĞ¾Ğ´ĞµĞ»Ğ¸Ñ‚ÑŒÑÑ" (Ğ§Ñ‚Ğ¾Ğ±Ñ‹ Ğ½Ğµ Ğ·Ğ°ĞºÑ€Ñ‹Ğ²Ğ°Ğ»Ğ¾ÑÑŒ!)
       function shareResult(steps) {
    // 1. Ğ£ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ ÑĞ·ĞµÑ€Ğ½ĞµĞ¹Ğ¼ Ñ‚Ğ²Ğ¾ĞµĞ³Ğ¾ Ğ±Ğ¾Ñ‚Ğ° Ğ‘Ğ•Ğ— ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ° @
    const botUsername = 'StepStarAppBot'; 
    
    // 2. Ğ‘ĞµÑ€ĞµĞ¼ Ñ‚ĞµĞºÑÑ‚ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ Ğ¸Ğ· ÑĞ»Ğ¾Ğ²Ğ°Ñ€Ñ Ğ¸ Ğ¿Ğ¾Ğ´ÑÑ‚Ğ°Ğ²Ğ»ÑĞµĞ¼ Ñ‡Ğ¸ÑĞ»Ğ¾ ÑˆĞ°Ğ³Ğ¾Ğ²
    const message = encodeURIComponent(t('shareMsg', appLang).replace('{n}', steps));
    
    // 3. Ğ¤Ğ¾Ñ€Ğ¼Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¿Ñ€ÑĞ¼ÑƒÑ ÑÑÑ‹Ğ»ĞºÑƒ Ğ½Ğ° Ğ¿ĞµÑ€ĞµÑÑ‹Ğ»ĞºÑƒ
    // url â€” ÑÑ‚Ğ¾ ÑÑÑ‹Ğ»ĞºĞ°, ĞºĞ¾Ñ‚Ğ¾Ñ€ÑƒÑ Ñ‡ĞµĞ»Ğ¾Ğ²ĞµĞº Ğ½Ğ°Ğ¶Ğ¼ĞµÑ‚ Ğ² Ñ‡Ğ°Ñ‚Ğµ (ÑÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° Ğ±Ğ¾Ñ‚Ğ°)
    // text â€” ÑÑ‚Ğ¾ ÑĞ¾Ğ¿Ñ€Ğ¾Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ñ‚ĞµĞºÑÑ‚ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ
    const shareUrl = `https://t.me/share/url?url=https://t.me/${botUsername}&text=${message}`;
    
    // 4. ĞÑ‚ĞºÑ€Ñ‹Ğ²Ğ°ĞµĞ¼ ÑÑ‚Ğ¾ Ñ‡ĞµÑ€ĞµĞ· Ğ¼ĞµÑ‚Ğ¾Ğ´ Telegram, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ğ½Ğµ Ğ·Ğ°ĞºÑ€Ñ‹Ğ»Ğ¾ÑÑŒ
    tg.openTelegramLink(shareUrl);
}

        // ĞŸĞµÑ€ĞµÑ…Ğ¾Ğ´ Ğ¼ĞµĞ¶Ğ´Ñƒ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğ°Ğ¼Ğ¸
        function navigate(pageId, el) {
            const app = document.getElementById('app');
            const user = tg.initDataUnsafe?.user || { first_name: "Ivan B." };
            
            app.innerHTML = Pages[pageId](user, userState, appLang);
            
            document.querySelectorAll('.tab-item').forEach(i => i.classList.remove('active'));
            if(el) el.classList.add('active');
            
            tg.HapticFeedback.impactOccurred('light');
        }

        // ĞŸĞ¾ĞºÑƒĞ¿ĞºĞ°/ÑĞ¼ĞµĞ½Ğ° Ñ€Ğ°Ğ¼ĞºĞ¸
        function changeFrame(color) {
            userState.frame = color;
            navigate('prof');
            tg.HapticFeedback.notificationOccurred('success');
        }

        // Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞµ
        window.onload = () => {
            tg.expand();
            tg.ready();

            // ĞŸÑ€Ğ¸Ğ½ÑƒĞ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ Ğ·Ğ°Ğ´ĞµÑ€Ğ¶ĞºĞ° 100Ğ¼Ñ Ğ´Ğ»Ñ ÑÑ‚Ğ°Ğ±Ğ¸Ğ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸ Ñ€ĞµĞ½Ğ´ĞµÑ€Ğ°
            setTimeout(() => {
                document.getElementById('txt-home').innerText = t('home', appLang);
                document.getElementById('txt-rank').innerText = t('rank', appLang);
                document.getElementById('txt-tour').innerText = t('tour', appLang);
                document.getElementById('txt-prof').innerText = t('prof', appLang);

                navigate('home', document.getElementById('btn-home'));
            }, 100);
        };
    </script>
</body>
</html>
